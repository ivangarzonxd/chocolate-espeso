<!doctype html>
<html lang="es">
  <head>
    <!-- Meta informaci√≥n -->
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Cuentas Claras v5</title>

    <!-- Estilos CSS unificados -->
    <link rel="stylesheet" href="./estilos.css" />

    <!-- Firebase - para autenticaci√≥n y base de datos en tiempo real -->
    <!-- compat.js permite usar sintaxis antigua compatible -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Fuente titulo -->
    <link href="https://fonts.googleapis.com/css2?family=BBH+Bogle&display=swap" rel="stylesheet">
    <!-- Fuente sutitulo -->
    <link href="https://fonts.googleapis.com/css2?family=BBH+Bogle&family=Damion&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">

  </head>
  <body>
    <!-- ================================================================
         PANTALLA 1 - ACCESO: Selecci√≥n de usuario
         ================================================================ -->
    <div id="pantalla-acceso" class="pantalla">
      <!-- Matriz de botones de usuarios (2x2) -->
      <div class="cuadricula-usuarios">
        <button
          class="boton boton-gris"
          onclick="Autenticacion.prepararAcceso('Ivan')"
        >
          Ivan
        </button>
        <button
          class="boton boton-gris"
          onclick="Autenticacion.prepararAcceso('Geral')"
        >
          Geral
        </button>
        <button
          class="boton boton-gris"
          onclick="Autenticacion.prepararAcceso('Michel')"
        >
          Michel
        </button>
        <button
          class="boton boton-gris"
          onclick="Autenticacion.prepararAcceso('Kimberly')"
        >
          Kimberly
        </button>
      </div>
    </div>

    <!-- ================================================================
         PANTALLA 2 - PIN: Ingreso del c√≥digo de acceso
         ================================================================ -->
    <div id="pantalla-pin" class="pantalla oculto">
      <!-- T√≠tulo din√°mico: "Hola [nombre]" o "Crea tu PIN" -->
      <h2 id="titulo-pin" class="texto-centro">PIN de Acceso</h2>

      <!-- Visor de asteriscos del PIN ingresado -->
      <div class="visor-pin" id="visor-pin"></div>

      <!-- Teclado num√©rico 3x4 (similar a calculadora) -->
      <div class="teclado-numerico">
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(1)">1</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(2)">2</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(3)">3</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(4)">4</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(5)">5</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(6)">6</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(7)">7</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(8)">8</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(9)">9</button>
        <button class="tecla-numero tecla-cancelar" onclick="Autenticacion.limpiarPin()">C</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(0)">0</button>
        <button class="tecla-numero tecla-aceptar" onclick="Autenticacion.verificarPin()">OK</button>
      </div>
    </div>

    <!-- ================================================================
         PANTALLA 3 - PRINCIPAL: Dashboard con saldos y transacciones
         ================================================================ -->
    <div id="pantalla-principal" class="pantalla oculto">
      <!-- Bienvenida y bot√≥n de salida -->
      <div class="linea-usuario">
        <span class="bienvenida">Bienvenido, <span id="nombre-usuario-barra">Usuario</span></span>
        <button class="boton boton-dashboard salir" onclick="Autenticacion.cerrarSesion()">Salir</button>
      </div>

      <!-- Tarjeta principal con saldo total neto del usuario -->
      <div class="tarjeta-saldo-total">
        <span class="etiqueta-saldo" id="etiqueta-saldo">Saldo Total</span>
        <h2 class="valor-saldo" id="valor-saldo-global">0‚Ç¨</h2>
      </div>

      <!-- Lista desplazable de cuentas con socios -->
      <!-- Cada fila muestra: nombre, saldo neto, y bot√≥n de historial -->
      <div class="contenedor-cuentas" id="lista-cuentas-contenedor"></div>

      <!-- Bot√≥n flotante para crear nuevo movimiento -->
      <button class="boton nuevo-movimiento" onclick="Interfaz.abrirModal('modal-socios')">+ NUEVO MOVIMIENTO</button>
    </div>

    <!-- ================================================================
         MODAL 1 - SELECCI√ìN DE SOCIO: Elige con qui√©n hacer transacci√≥n
         ================================================================ -->
    <div id="modal-socios" class="fondo-modal">
      <div class="contenedor-modal">
        <h3 class="texto-centro">¬øCon qui√©n?</h3>
        <!-- Lista generada din√°micamente con los otros usuarios -->
        <div id="lista-socios-disponibles" class="flexible-columna separacion-md"></div>
        <button class="boton" onclick="Interfaz.cerrarModal('modal-socios')">Cancelar</button>
      </div>
    </div>

    <!-- ================================================================
         PANTALLA 4 - TRANSACCI√ìN: Formulario + Historial completo
         ================================================================ -->
    <div id="pantalla-transaccion" class="pantalla oculto">
      <div class="contenedor-transaccion-completo">
        <!-- Nombre del socio seleccionado -->
        <h2 id="titulo-socio-transaccion" class="texto-centro">Socio</h2>

        <!-- Botones para seleccionar tipo de transacci√≥n (ancho completo, pila) -->
        <div id="seccion-tipos" class="pila-botones">
          <button class="boton boton-verde" onclick="Transacciones.prepararTipo('preste')">Le prest√©</button>
          <button class="boton boton-rojo" onclick="Transacciones.prepararTipo('me_prestaron')">Me prest√≥</button>
          <button id="boton-abonar" class="boton boton-azul" onclick="Transacciones.prepararTipo('abono')">Abonar / Pagar</button>
        </div>

        <!-- Opciones espec√≠ficas para ABONO -->
        <div id="abono-opciones" class="oculto margen-superior pila-botones">
          <button class="boton boton-blanco" onclick="Transacciones.seleccionarDestinoAbono('general')">Abonar al general</button>
          <button class="boton boton-blanco" onclick="Transacciones.seleccionarDestinoAbono('especifica')">Abonar a deuda espec√≠fica</button>
          <div id="abono-especifico-contenedor" class="oculto margen-superior">
            <select id="selector-deuda-especifica" class="campo-entrada"></select>
          </div>
        </div>

        <div id="seccion-formulario" class="oculto margen-superior pila-botones">
          <input type="number" id="input-monto" class="campo-entrada" placeholder="Monto ‚Ç¨" inputmode="decimal" />
          <input type="text" id="input-concepto" class="campo-entrada" placeholder="Concepto (opcional)" />
          <button class="boton boton-naranja" onclick="Transacciones.guardarMovimiento()">GUARDAR DATOS</button>
        </div>

        <div class="acciones-transaccion-inferior">
          <div class="divisor-transaccion"></div>
          <button class="boton boton-gris" onclick="Transacciones.abrirHistorialPantalla()">
            üìñ Ver Historial
          </button>
          <button class="boton boton-gris" onclick="Transacciones.cancelarTransaccion()">
            Volver
          </button>
        </div>
      </div>
    </div>

    <!-- ================================================================
         PANTALLA 5 - HISTORIAL COMPLETO: Todas las transacciones
         ================================================================ -->
    <div id="pantalla-historial" class="pantalla oculto">
      <div class="contenedor-historial-pantalla">
        <!-- Nombre del socio -->
        <h2 id="nombre-socio-historial-pantalla" class="texto-centro">Historial</h2>

        <!-- Encabezados de columnas -->
        <div class="encabezado-historial">
          <div class="columna-fecha">Fecha / Concepto</div>
          <div class="columna-monto">Monto</div>
        </div>

        <!-- Lista de transacciones -->
        <div id="contenedor-historial-pantalla" class="lista-historial"></div>

        <!-- Barra inferior con acciones -->
        <div class="barra-inferior-historial">
          <div id="control-eliminar-pie" class="control-eliminar-pie" onclick="Transacciones.toggleModoEliminarHistorial()">
            <span class="icono-eliminar">üóëÔ∏è</span>
            <span class="texto-eliminar">Eliminar un movimiento</span>
          </div>
          <button class="boton boton-gris boton-volver-historial" onclick="Interfaz.cambiarPantalla('pantalla-transaccion')">Volver</button>
        </div>
      </div>
    </div>

    <!-- ================================================================
         MODAL 4 - SELECCI√ìN DE DEUDA ESPEC√çFICA PARA ABONO
         ================================================================ -->
    <div id="modal-seleccion-deuda" class="fondo-modal">
      <div class="contenedor-modal contenedor-modal-historial">
        <h3 class="texto-centro">Selecciona una deuda espec√≠fica</h3>
        <div id="lista-deudas-especificas" class="lista-historial"></div>
        <button
          class="boton boton-transparente"
          onclick="Interfaz.cerrarModal('modal-seleccion-deuda')"
        >
          Cancelar
        </button>
      </div>
    </div>

    <!-- Contenedor para notificaciones toast -->
    <div id="contenedor-notificaciones"></div>

    <!-- ================================================================
         SCRIPTS - Cargar m√≥dulos de la aplicaci√≥n en orden
         ================================================================ -->
    <!-- Archivo de configuraci√≥n Firebase (debe ir primero) -->
    <script src="js/configuracion.js"></script>
    <!-- Control de UI (pantallas y modales) -->
    <script src="js/interfaz.js"></script>
    <!-- Autenticaci√≥n y gesti√≥n de acceso -->
    <script src="js/autenticacion.js"></script>
    <!-- Dashboard y c√°lculos de saldos -->
    <script src="js/principal.js"></script>
    <!-- Gesti√≥n de transacciones y historial -->
    <script src="js/transacciones.js"></script>

    <!-- Inicializaci√≥n: Cargar headers reutilizables cuando el DOM est√© listo -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            Interfaz.cargarHeadersReutilizables();
        });
    </script>
  </body>
</html>
