<!doctype html>
<html lang="es">
  <head>
    <!-- Meta información -->
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Cuentas Claras v5</title>

    <!-- Estilos CSS -->
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/componentes.css" />
    <link rel="stylesheet" href="css/login.css" />
    <link rel="stylesheet" href="css/pin.css" />
    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/modales.css" />

    <!-- Firebase - para autenticación y base de datos en tiempo real -->
    <!-- compat.js permite usar sintaxis antigua compatible -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Fuente titulo -->
    <link href="https://fonts.googleapis.com/css2?family=BBH+Bogle&display=swap" rel="stylesheet">
    <!-- Fuente sutitulo -->
    <link href="https://fonts.googleapis.com/css2?family=BBH+Bogle&family=Damion&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">

  </head>
  <body>
    <!-- ================================================================
         PANTALLA 1 - ACCESO: Selección de usuario
         ================================================================ -->
    <div id="pantalla-acceso" class="pantalla">
      <!-- Header global de la aplicación -->
      <div class="encabezado-global">
        <h1 class="titulo-encabezado">LAS CUENTAS CLARAS</h1>
        <p class="subtitulo-encabezado">y el chocolate espeso</p>
        <div class="icono-marca">☕</div>
      </div>

      <!-- Matriz de botones de usuarios (2x2) -->
      <div class="cuadricula-usuarios">
        <button
          class="boton boton-gris"
          onclick="Autenticacion.prepararAcceso('Ivan')"
        >
          Ivan
        </button>
        <button
          class="boton boton-gris"
          onclick="Autenticacion.prepararAcceso('Geral')"
        >
          Geral
        </button>
        <button
          class="boton boton-gris"
          onclick="Autenticacion.prepararAcceso('Michel')"
        >
          Michel
        </button>
        <button
          class="boton boton-gris"
          onclick="Autenticacion.prepararAcceso('Kimberly')"
        >
          Kimberly
        </button>
      </div>
    </div>

    <!-- ================================================================
         PANTALLA 2 - PIN: Ingreso del código de acceso
         ================================================================ -->
    <div id="pantalla-pin" class="pantalla oculto">
      <!-- Header global de la aplicación -->
      <div class="encabezado-global">
        <h1 class="titulo-encabezado">LAS CUENTAS CLARAS</h1>
        <p class="subtitulo-encabezado">y el chocolate espeso</p>
        <div class="icono-marca">☕</div>
      </div>

      <!-- Título dinámico: "Hola [nombre]" o "Crea tu PIN" -->
      <h2 id="titulo-pin" class="texto-centro">PIN de Acceso</h2>

      <!-- Visor de asteriscos del PIN ingresado -->
      <div class="visor-pin" id="visor-pin"></div>

      <!-- Teclado numérico 3x4 (similar a calculadora) -->
      <div class="teclado-numerico">
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(1)">1</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(2)">2</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(3)">3</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(4)">4</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(5)">5</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(6)">6</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(7)">7</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(8)">8</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(9)">9</button>
        <button class="tecla-numero tecla-cancelar" onclick="Autenticacion.limpiarPin()">C</button>
        <button class="tecla-numero" onclick="Autenticacion.escribirPin(0)">0</button>
        <button class="tecla-numero tecla-aceptar" onclick="Autenticacion.verificarPin()">OK</button>
      </div>
    </div>

    <!-- ================================================================
         PANTALLA 3 - PRINCIPAL: Dashboard con saldos y transacciones
         ================================================================ -->
    <div id="pantalla-principal" class="pantalla oculto">
      <!-- Header global de la aplicación -->
      <div class="titulo-dashboard">
        <div class="logo-linea">
          <span class="primer-titulo-dashboard">LAS CUENTAS CLARAS</span>
          <span class="segundo-titulo-dashboard">y el chocolate espeso
          <span class="icono-dashboard">☕</span></span>
        </div>
      </div>

      <!-- Bienvenida y botón de salida -->
      <div class="linea-usuario">
        <span class="bienvenida">Bienvenido, <span id="nombre-usuario-barra">Usuario</span></span>
        <button class="boton-dashboard salir" onclick="Autenticacion.cerrarSesion()">Salir</button>
      </div>

      <!-- Tarjeta principal con saldo total neto del usuario -->
      <div class="tarjeta-saldo-total">
        <span class="etiqueta-saldo" id="etiqueta-saldo">Saldo Total</span>
        <h2 class="valor-saldo" id="valor-saldo-global">0€</h2>
      </div>

      <!-- Lista desplazable de cuentas con socios -->
      <!-- Cada fila muestra: nombre, saldo neto, y botón de historial -->
      <div class="contenedor-cuentas" id="lista-cuentas-contenedor"></div>

      <!-- Botón flotante para crear nuevo movimiento -->
      <div class="boton-nuevo-movimiento">
        <button class="boton-dashboard inferior" onclick="Interfaz.abrirModal('modal-socios')"> + NUEVO MOVIMIENTO</button>
      </div>
    </div>

    <!-- ================================================================
         MODAL 1 - SELECCIÓN DE SOCIO: Elige con quién hacer transacción
         ================================================================ -->
    <div id="modal-socios" class="fondo-modal">
      <div class="contenedor-modal">
        <h3 class="texto-centro">¿Con quién?</h3>
        <!-- Lista generada dinámicamente con los otros usuarios -->
        <div id="lista-socios-disponibles" class="flexible-columna separacion-md"></div>
        <button class="boton boton-transparente" onclick="Interfaz.cerrarModal('modal-socios')">Cancelar</button>
      </div>
    </div>

    <!-- ================================================================
         MODAL 2 - TRANSACCIÓN: Ingresa monto, concepto y tipo de préstamo
         ================================================================ -->
    <div id="modal-transaccion" class="fondo-modal">
      <div class="contenedor-modal">
        <!-- Nombre del socio seleccionado -->
        <h2 id="titulo-socio-transaccion" class="texto-centro">Socio</h2>

        <!-- Botones para seleccionar tipo de transacción -->
        <div class="cuadricula-2-columnas separacion-md">
          <button class="boton boton-verde-suave" onclick="Transacciones.prepararTipo('preste')">Le presté</button>
          <button class="boton boton-rojo-suave" onclick="Transacciones.prepararTipo('me_prestaron')">Me prestó</button>
        </div>
        <button class="boton boton-azul" style="margin-top: 10px" onclick="Transacciones.prepararTipo('abono')">Abonar / Pagar</button>

        <!-- Formulario: monto, concepto y guardar (se muestra después de seleccionar tipo) -->
        <!-- Opciones específicas para ABONO -->
        <div id="abono-opciones" class="oculto margen-superior">
          <div class="cuadricula-2-columnas separacion-md">
            <button class="boton boton-blanco" onclick="Transacciones.seleccionarDestinoAbono('general')">Abonar al general</button>
            <button class="boton boton-blanco" onclick="Transacciones.seleccionarDestinoAbono('especifica')">Abonar a deuda específica</button>
          </div>
          <!-- Selector de deuda específica (se muestra solo si corresponde) -->
          <div id="abono-especifico-contenedor" class="oculto margen-superior">
            <select id="selector-deuda-especifica" class="campo-entrada"></select>
          </div>
        </div>

        <div id="seccion-formulario" class="oculto margen-superior">
          <input
            type="number"
            id="input-monto"
            class="campo-entrada"
            placeholder="Monto €"
          />
          <input
            type="text"
            id="input-concepto"
            class="campo-entrada"
            placeholder="Concepto"
          />
          <button
            class="boton boton-naranja"
            onclick="Transacciones.guardarMovimiento()"
          >
            GUARDAR DATOS
          </button>
        </div>
        <button
          class="boton boton-transparente"
          onclick="Interfaz.cerrarModal('modal-transaccion')"
        >
          Cerrar
        </button>
      </div>
    </div>

    <!-- ================================================================
         MODAL 3 - HISTORIAL: Ver todas las transacciones con un socio
         ================================================================ -->
    <div id="modal-historial" class="fondo-modal">
      <div class="contenedor-modal contenedor-modal-historial">
        <!-- Nombre del socio -->
        <h2 id="nombre-socio-historial" class="texto-centro">Historial</h2>

        <!-- Encabezados de columnas -->
        <div class="encabezado-historial">
          <div class="columna-fecha">Fecha / Concepto</div>
          <div class="columna-monto">Monto</div>
          <div class="columna-accion">Acción</div>
        </div>

        <!-- Lista de transacciones -->
        <div id="contenedor-historial" class="lista-historial"></div>

        <button
          class="boton boton-transparente"
          onclick="Interfaz.cerrarModal('modal-historial')"
        >
          Cerrar
        </button>
      </div>
    </div>

    <!-- ================================================================
         MODAL 4 - SELECCIÓN DE DEUDA ESPECÍFICA PARA ABONO
         ================================================================ -->
    <div id="modal-seleccion-deuda" class="fondo-modal">
      <div class="contenedor-modal contenedor-modal-historial">
        <h3 class="texto-centro">Selecciona una deuda específica</h3>
        <div id="lista-deudas-especificas" class="lista-historial"></div>
        <button
          class="boton boton-transparente"
          onclick="Interfaz.cerrarModal('modal-seleccion-deuda')"
        >
          Cancelar
        </button>
      </div>
    </div>

    <!-- ================================================================
         SCRIPTS - Cargar módulos de la aplicación en orden
         ================================================================ -->
    <!-- Archivo de configuración Firebase (debe ir primero) -->
    <script src="js/configuracion.js"></script>
    <!-- Control de UI (pantallas y modales) -->
    <script src="js/interfaz.js"></script>
    <!-- Autenticación y gestión de acceso -->
    <script src="js/autenticacion.js"></script>
    <!-- Dashboard y cálculos de saldos -->
    <script src="js/principal.js"></script>
    <!-- Gestión de transacciones y historial -->
    <script src="js/transacciones.js"></script>
  </body>
</html>
